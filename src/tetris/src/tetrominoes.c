#include <stdio.h>

#include "tetrominoes.h"

// Specifies the 7 tetrominoes and its 4 rotations
// First element in the array is empty
TetrominoType tetrominoes[8][4][TETROMINO_SIZE_Y][TETROMINO_SIZE_X] = {
    { 0 },
    {
        {
            {0, 1, 1, 0}, // O Piece
            {0, 1, 1, 0},
            {0, 0, 0, 0},
            {0, 0, 0, 0},
        },
        {
            {0, 1, 1, 0}, // O Piece
            {0, 1, 1, 0},
            {0, 0, 0, 0},
            {0, 0, 0, 0},
        },
        {
            {0, 1, 1, 0}, // O Piece
            {0, 1, 1, 0},
            {0, 0, 0, 0},
            {0, 0, 0, 0},
        },
        {
            {0, 1, 1, 0}, // O Piece
            {0, 1, 1, 0},
            {0, 0, 0, 0},
            {0, 0, 0, 0},
        }
    },
    {
        {
            {0, 0, 0, 0}, // I Piece
            {2, 2, 2, 2},
            {0, 0, 0, 0},
            {0, 0, 0, 0},
        },
        {
            {0, 0, 2, 0},
            {0, 0, 2, 0},
            {0, 0, 2, 0},
            {0, 0, 2, 0},
        },
        {
            {0, 0, 0, 0},
            {0, 0, 0, 0},
            {2, 2, 2, 2},
            {0, 0, 0, 0},
        },
        {
            {0, 2, 0, 0},
            {0, 2, 0, 0},
            {0, 2, 0, 0},
            {0, 2, 0, 0},
        },
    },
    {
        {
            {0, 3, 3, 0}, // S Piece
            {3, 3, 0, 0},
            {0, 0, 0, 0},
            {0, 0, 0, 0},
        },
        {
            {0, 3, 0, 0},
            {0, 3, 3, 0},
            {0, 0, 3, 0},
            {0, 0, 0, 0},
        },
        {
            {0, 0, 0, 0},
            {0, 3, 3, 0},
            {3, 3, 0, 0},
            {0, 0, 0, 0},
        },
        {
            {3, 0, 0, 0},
            {3, 3, 0, 0},
            {0, 3, 0, 0},
            {0, 0, 0, 0},
        }

    },
    {
        {
            {4, 4, 0, 0}, // Z piece
            {0, 4, 4, 0},
            {0, 0, 0, 0},
            {0, 0, 0, 0},
        },
        {
            {0, 0, 4, 0},
            {0, 4, 4, 0},
            {0, 4, 0, 0},
            {0, 0, 0, 0},
        },
        {
            {0, 0, 0, 0},
            {4, 4, 0, 0},
            {0, 4, 4, 0},
            {0, 0, 0, 0},
        },
        {
            {0, 4, 0, 0},
            {4, 4, 0, 0},
            {4, 0, 0, 0},
            {0, 0, 0, 0},
        }
    },
    {
        {
            {0, 0, 5, 0}, // L piece
            {5, 5, 5, 0},
            {0, 0, 0, 0},
            {0, 0, 0, 0},
        },
        {
            {0, 5, 0, 0},
            {0, 5, 0, 0},
            {0, 5, 5, 0},
            {0, 0, 0, 0},
        },
        {
            {0, 0, 0, 0},
            {5, 5, 5, 0},
            {5, 0, 0, 0},
            {0, 0, 0, 0},
        },
        {
            {5, 5, 0, 0},
            {0, 5, 0, 0},
            {0, 5, 0, 0},
            {0, 0, 0, 0},
        }
    },
    {
        {
            {6, 0, 0, 0}, // J piece
            {6, 6, 6, 0},
            {0, 0, 0, 0},
            {0, 0, 0, 0},
        },
        {
            {0, 6, 6, 0},
            {0, 6, 0, 0},
            {0, 6, 0, 0},
            {0, 0, 0, 0},
        },
        {
            {0, 0, 0, 0},
            {6, 6, 6, 0},
            {0, 0, 6, 0},
            {0, 0, 0, 0},
        },
        {
            {0, 6, 0, 0},
            {0, 6, 0, 0},
            {6, 6, 0, 0},
            {0, 0, 0, 0},
        }

    },
    {
        {
            {0, 7, 0, 0}, // T piece
            {7, 7, 7, 0},
            {0, 0, 0, 0},
            {0, 0, 0, 0},
        },
        {
            {0, 7, 0, 0},
            {0, 7, 7, 0},
            {0, 7, 0, 0},
            {0, 0, 0, 0},
        },
        {
            {0, 0, 0, 0},
            {7, 7, 7, 0},
            {0, 7, 0, 0},
            {0, 0, 0, 0},
        },
        {
            {0, 7, 0, 0},
            {7, 7, 0, 0},
            {0, 7, 0, 0},
            {0, 0, 0, 0},
        },
    }
};


// Wall kick data for each piece
// First index is the piece, second index is the rotation state, third index is the test number
// Each test contains an x and y offset
int wall_kicks[8][4][5][2] = {
    {},
    { // O Piece has no wall kicks
            {{0, 0}, {0, 0}, {0, 0}, {0, 0}, {0, 0}},
            {{0, 0}, {0, 0}, {0, 0}, {0, 0}, {0, 0}},
            {{0, 0}, {0, 0}, {0, 0}, {0, 0}, {0, 0}},
            {{0, 0}, {0, 0}, {0, 0}, {0, 0}, {0, 0}}
    },
    { // I Piece
            {{0, 0}, {-2, 0}, {1, 0}, {-2, 1}, {1, -2}},
            {{0, 0}, {-1, 0}, {2, 0}, {-1, -2}, {2, 1}},
            {{0, 0}, {2, 0}, {-1, 0}, {2, -1}, {-1, 2}},
            {{0, 0}, {1, 0}, {-2, 0}, {-1, -2}, {2, 1}}
    },
    { // S Piece
            {{0, 0}, {-1, 0}, {-1, -1}, {0, 2}, {-1, 2}},
            {{0, 0}, {1, 0}, {1, 1}, {0, -2}, {1, -2}},
            {{0, 0}, {1, 0}, {1, -1}, {0, 2}, {1, 2}},
            {{0, 0}, {-1, 0}, {-1, 1}, {0, 2}, {-1, 2}}
    },
    { // Z Piece
            {{0, 0}, {-1, 0}, {-1, -1}, {0, 2}, {-1, 2}},
            {{0, 0}, {1, 0}, {1, 1}, {0, -2}, {1, -2}},
            {{0, 0}, {1, 0}, {1, -1}, {0, 2}, {1, 2}},
            {{0, 0}, {-1, 0}, {-1, 1}, {0, 2}, {-1, 2}}
    },
    { // J Piece
            {{0, 0}, {-1, 0}, {-1, -1}, {0, 2}, {-1, 2}},
            {{0, 0}, {1, 0}, {1, 1}, {0, -2}, {1, -2}},
            {{0, 0}, {1, 0}, {1, -1}, {0, 2}, {1, 2}},
            {{0, 0}, {-1, 0}, {-1, 1}, {0, 2}, {-1, 2}}
    },
    { // L Piece
            {{0, 0}, {-1, 0}, {-1, -1}, {0, 2}, {-1, 2}},
            {{0, 0}, {1, 0}, {1, 1}, {0, -2}, {1, -2}},
            {{0, 0}, {1, 0}, {1, -1}, {0, 2}, {1, 2}},
            {{0, 0}, {-1, 0}, {-1, 1}, {0, 2}, {-1, 2}}
    },
    { // T Piece
            {{0, 0}, {-1, 0}, {-1, -1}, {0, 2}, {-1, 2}},
            {{0, 0}, {1, 0}, {1, 1}, {0, -2}, {1, -2}},
            {{0, 0}, {1, 0}, {1, -1}, {0, 2}, {1, 2}},
            {{0, 0}, {-1, 0}, {-1, 1}, {0, 2}, {-1, 2}}
    }
};

void printTetrominoType(const TetrominoType type) {
    switch (type) {
        case TETROMINO_O: printf("O"); break;
        case TETROMINO_I: printf("I"); break;
        case TETROMINO_S: printf("S"); break;
        case TETROMINO_Z: printf("Z"); break;
        case TETROMINO_L: printf("L"); break;
        case TETROMINO_J: printf("J"); break;
        case TETROMINO_T: printf("T"); break;
        default: printf("TETROMINO_EMPTY");
    }
}

void printTetrominoes(const TetrominoType piece, const TetrominoRotation rotation){
    for (int i = 0; i < 4; i++){
        for (int j = 0; j < 4; j++){
            printf("%d", tetrominoes[(size_t) piece][rotation][i][j]);
        }
        printf("\n");
    }
}
